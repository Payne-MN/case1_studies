{"cells":[{"source":"<a href=\"https://www.kaggle.com/code/paynembeng/cyclistic-bike-share-case-study?scriptVersionId=177830662\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>","metadata":{},"cell_type":"markdown"},{"cell_type":"markdown","id":"57775c99","metadata":{"_execution_state":"idle","_uuid":"051d70d956493feee0c6d64651c6a088724dca2a","execution":{"iopub.execute_input":"2024-05-15T13:59:06.205531Z","iopub.status.busy":"2024-05-15T13:59:06.20244Z","iopub.status.idle":"2024-05-15T13:59:06.385217Z"},"papermill":{"duration":0.002402,"end_time":"2024-05-15T14:42:35.061228","exception":false,"start_time":"2024-05-15T14:42:35.058826","status":"completed"},"tags":[]},"source":["# INTRO\n","------------------------------------------------------------------------\n","\n","  The following analysis is originally based on the case study “‘Sophisticated, Clear, and Polished’: Divvy and Data Visualization” written by Kevin Hartman [found here](https://artscience.blog/home/divvy-dataviz-case-study). We will be using the Divvy dataset for the case study, as part of the Google Data Analytics Program. The data has been made publicly available by *Motivate International Inc*. under this license. Due to data-privacy, any personally-identifiable information has been removed/encrypted.\n","_______________________________________________________________________\n","\n","# CASE\n","\n","   The director of marketing believes the company’s future success depends on maximizing the number of annual memberships. Therefore, your team wants to understand how casual riders and annual members use Cyclistic bikes differently. From these insights, your team will design a new marketing strategy to convert casual riders into annual members. But first, Cyclistic executives must approve your recommendations, so they must be backed up with compelling data insights and professional data visualizations.\n","Business Task\n","\n","How do annual members and casual riders use Cyclistic bikes differently?\n","\n","\n","```{r setup, include=FALSE}\n","knitr::opts_chunk$set(echo = TRUE)\n","\n","library(tidyverse)\n","library(dplyr)\n","library(readr)\n","library(knitr)\n","library(kableExtra)\n","\n","```\n","\n","\n","# **STEP 1: COLLECT DATA**\n","  \n","\n","## Uploading dataset\n","\n","First we all the datasets for analysis, which are  - [q1, q2, q3, q4_2019, q1_ 2020] (csv files) \n","\n","```{r include=FALSE}\n","q1_2019 <- read_csv(\"C:/Users/DELL/Downloads/Divvy_Trips_2019_Q1.zip\")\n","\n","q1_2020 <- read_csv(\"C:/Users/DELL/Desktop/CASE STUDY 1/Cyclistic_bike_Raw_data/Divvy_Trips_2020_Q1.csv\")\n","\n","q2_2019 <- read_csv(\"C:/Users/DELL/Desktop/CASE STUDY 1/Cyclistic_bike_Raw_data/Divvy_Trips_2019_Q2.csv\")\n","\n","q3_2019 <- read_csv(\"C:/Users/DELL/Desktop/CASE STUDY 1/Cyclistic_bike_Raw_data/Divvy_Trips_2019_Q3.csv\")\n","\n","q4_2019 <- read_csv(\"C:/Users/DELL/Desktop/CASE STUDY 1/Cyclistic_bike_Raw_data/Divvy_Trips_2019_Q4.csv\")\n","```\n","\n","```{r include=FALSE}\n","\n","view(q1_2019)\n","```\n","\n","```{r}\n","view(q2_2019)\n","```\n","\n","```{r}\n","view(q3_2019)\n","```\n","\n","```{r echo=TRUE}\n","view(q4_2019)\n","```\n","\n","```{r echo=TRUE}\n","view(q1_2020)\n","```\n","\n","\n","\n","#         **STEP 2: PREPARE / CLEAN DATA**\n","------------------------------------------------------------------------------\n","we then use a command to join the datasets into one file, but first;\n","\n","## *Rename columns to make them consistent with q1_2020 (as this will be the supposed*\n","\n"," - Also, ride_id and rideable_type are Converted to character so that they can stack correctly, using code chunk...\n"," \n","------------------------------------------------------------------------------\n","```{r include=FALSE}\n","(q1_2019 <- rename(q1_2019\n","                   ,ride_id = trip_id\n","                   ,rideable_type = bikeid\n","                   ,started_at = start_time\n","                   ,ended_at = end_time\n","                   ,start_station_name = from_station_name\n","                   ,start_station_id = from_station_id\n","                   ,end_station_name = to_station_name\n","                   ,end_station_id = to_station_id\n","                   ,member_casual = 'usertype'\n","                 \n","))\n","```\n","\n","```{r}\n","q1_2019 <- mutate(q1_2019, ride_id = as.character(ride_id)\n","                  ,end_station_id = as.character(end_station_id)\n","                  ,rideable_type = as.character(rideable_type))\n","```\n","\n","```{r include=FALSE}\n","(q2_2019 <- rename(q2_2019\n","                   ,ride_id = '01 - Rental Details Rental ID'\n","                   ,rideable_type = '01 - Rental Details Bike ID'\n","                   ,started_at = '01 - Rental Details Local Start Time'\n","                   ,ended_at = '01 - Rental Details Local End Time'\n","                   ,start_station_name = '03 - Rental Start Station Name'\n","                   ,start_station_id = '03 - Rental Start Station ID'\n","                   ,end_station_name = '02 - Rental End Station Name'\n","                   ,end_station_id = '02 - Rental End Station ID'\n","                   ,member_casual = 'User Type'\n",")) \n","```\n","\n","```{r}\n","q2_2019 <- mutate(q2_2019, ride_id = as.character(ride_id)\n","                    ,end_station_id = as.character(end_station_id)\n","                    ,rideable_type = as.character(rideable_type))\n","```                    \n","\n","\n","```{r include=FALSE}\n","(q3_2019 <- rename(q3_2019\n","                     ,ride_id = 'trip_id'\n","                     ,rideable_type = 'bikeid'\n","                     ,started_at = 'start_time'\n","                     ,ended_at = 'end_time'\n","                     ,start_station_name = 'from_station_name'\n","                     ,start_station_id = 'from_station_id'\n","                     ,end_station_name = 'to_station_name'\n","                     ,end_station_id = 'to_station_id'\n","                     ,member_casual = 'usertype'\n","))                   \n","```\n","\n","```{r}\n","  q3_2019 <- mutate(q3_2019, ride_id = as.character(ride_id)\n","                    ,end_station_id = as.character(end_station_id)\n","                    ,rideable_type = as.character(rideable_type))\n","```\n","\n","```{r include=FALSE}\n","  (q4_2019 <- rename(q4_2019\n","                     ,ride_id = 'trip_id'\n","                     ,rideable_type = 'bikeid'\n","                     ,started_at = 'start_time'\n","                     ,ended_at = 'end_time'\n","                     ,start_station_name = 'from_station_name'\n","                     ,start_station_id = 'from_station_id'\n","                     ,end_station_name = 'to_station_name'\n","                     ,end_station_id = 'to_station_id'\n","                     ,member_casual = 'usertype'\n","  ))  \n","```\n","\n","```{r}\n","   q4_2019 <- mutate(q4_2019, ride_id = as.character(ride_id)\n","                    ,end_station_id = as.character(end_station_id)\n","                    ,rideable_type = as.character(rideable_type)) \n","```\n","\n","```{r}  \n","q1_2020 <- mutate(q1_2020, ride_id = as.character(ride_id)\n","                    ,end_station_id = as.character(end_station_id)\n","                    ,rideable_type = as.character(rideable_type))\n","```\n","\n","\n","-----------------------------------------------------------------------------\n","\n"," -  The dataframes are inspected and there are no incongruencies\n","\n","```{r}\n","colnames(q1_2019)\n","colnames(q1_2020)\n","```\n","\n","\n"," * Then Stack individual quarter's data frames into one big data frame named 'all_trips`\n","\n","\n","```{r}\n","all_trips <- bind_rows(q1_2019, q1_2020, q2_2019, q3_2019, q4_2019)\n","```\n","\n","```{r}\n","view(all_trips)\n","```\n","\n"," -  Next, removal of colums, lat, long, birthyear, and gender fields as this data was dropped beginning in 2020. Here below is the code...\n","\n","\n","```{r}\n","all_trips <- all_trips %>%\n","select(-c(start_lat, start_lng, end_lat, end_lng, birthyear, gender, \"tripduration\", '01 - Rental Details Duration In Seconds Uncapped', \"Member Gender\", \"05 - Member Details Member Birthday Year\"))\n","```\n","\n","\n","---------------------------------------------------------------------------\n","\n","# **STEP 3: CLEAN UP AND ADD DATA TO PREPARE FOR ANALYSIS**\n","\n","\n","Inspect the new table that has been created\n","\n","```{r}\n","colnames(all_trips) #List of column names\n","nrow(all_trips) #How many rows are in data frame?\n","dim(all_trips) #Dimensions of the data frame?\n","head(all_trips) #See the first 6 rows of data frame. Also tail(all_trips)\n","str(all_trips) #See list of columns and data types (numeric, character, etc)\n","summary(all_trips) #Statistical summary of data. Mainly for numerics\n","```\n","\n","\n","### There are a few problems we will need to fix:\n","\n"," 1) In the \"member_casual\" column, there are two names for members (\"member\" and \"Subscriber\") and two names for casual riders (\"Customer\" and \"casual\"). We will need to consolidate that from four to two labels.\n"," 2) The data can only be aggregated at the ride-level, which is too granular. We will want to add some additional columns of data -- such as day, month, year -- that provide additional opportunities to aggregate the data.\n"," \n"," 3) We will want to add a calculated field for length of ride since the 2020Q1 data did not have the \"tripduration\" column. We will add \"ride_length\" to the entire dataframe for consistency.\n"," 4) There are some rides where tripduration shows up as negative, including several hundred rides where Divvy took bikes out of circulation for Quality Control reasons. We will want to delete these rides.\n","\n"," - In the \"member_casual\" column, replace \"Subscriber\" with \"member\" and \"Customer\" with\n","\"casual\"\n"," - Before 2020, Divvy used different labels for these two types of riders ... we will want to make our dataframe consistent with their current nomenclature\n","\n","**N.B.**: \"Level\" is a special property of a column that is retained even if a subset does not contain any values from a specific level\n","\n","\n","#### We begin by seeing how many observations fall under each usertype\n","\n","```{r}\n","table(all_trips$member_casual)\n","```\n","\n"," * Reassign to the desired values (we will go with the current 2020 labels)\n","```{r}\n","all_trips <- all_trips %>%\n","mutate(member_casual = recode(member_casual\n",",\"Subscriber\" = \"member\"\n",",\"Customer\" = \"casual\"))\n","```\n","\n","\n","We will add columns that list the date, month, day, and year of each ride\n","\n","This will allow us to aggregate ride data for each month, day, or year ... \n","\n","```{r}\n","all_trips$date <- as.Date(all_trips$started_at) \n","all_trips$month <- format(as.Date(all_trips$date), \"%m\")\n","all_trips$day <- format(as.Date(all_trips$date), \"%d\")\n","all_trips$year <- format(as.Date(all_trips$date), \"%Y\")\n","all_trips$day_of_week <- format(as.Date(all_trips$date), \"%A\")\n","```\n","\n","Then add a \"ride_length\" calculation to all_trips (in seconds)\n","\n","```{r}\n","all_trips$ride_length <- difftime(all_trips$ended_at,all_trips$started_at)\n","```\n","\n","Inspect the structure of the columns\n","\n","```{r}\n","str(all_trips)\n","```\n","We then Convert \"ride_length\" from Factor to numeric by eliminating 'secs' in the string so we can run calculations on the data\n","\n","```{r}\n","is.factor(all_trips$ride_length)\n","all_trips$ride_length <- as.numeric(as.character(all_trips$ride_length))\n","is.numeric(all_trips$ride_length)\n","```\n","## **Next we remove \"bad\" data**\n","\n","\n","  The dataframe includes a few hundred entries when bikes were taken out of docks andchecked for quality by Divvy or ride_length was negative then We will create a new version of the dataframe (v2) since data is being removed\n","\n","```{r}\n","all_trips_v2 <- all_trips[!(all_trips$start_station_name == \"HQ QR\" | all_trips$ride_length<0),]\n","```\n","\n","# **STEP 4: CONDUCT DESCRIPTIVE ANALYSIS**\n","\n","\n","We do descriptive analysis using ride_length (all figures in seconds)\n","\n","```{r}\n","mean(all_trips_v2$ride_length)\n","```\n","_straight average (total ride length / rides)_\n","\n","```{r}\n","median(all_trips_v2$ride_length) \n","```\n","\n","_midpoint number in the ascending array of ride lengths_\n","\n","```{r}\n","max(all_trips_v2$ride_length) #longest ride\n","min(all_trips_v2$ride_length) #shortest ride\n","```\n","\n","\n","we can condense the four lines above to one line using summary() on the specific attribute\n","\n","```{r include=FALSE}\n","summary(all_trips_v2$ride_length)\n","```\n","\n","\n"," We then Compare members and casual users\n"," \n","```{r}\n","aggregate(all_trips_v2$ride_length ~ all_trips_v2$member_casual, FUN = mean)\n","aggregate(all_trips_v2$ride_length ~ all_trips_v2$member_casual, FUN = median)\n","aggregate(all_trips_v2$ride_length ~ all_trips_v2$member_casual, FUN = max)\n","aggregate(all_trips_v2$ride_length ~ all_trips_v2$member_casual, FUN = min)\n","```\n","\n","This lets us see the average ride time by each day for members vs casual users\n","\n","```{r}\n","aggregate(all_trips_v2$ride_length ~ all_trips_v2$member_casual + all_trips_v2$day_of_week,\n","FUN = mean)\n","```\n","\n","Notice that the days of the week are out of order. Let's fix that.\n","\n","```{r}\n","all_trips_v2$day_of_week <- ordered(all_trips_v2$day_of_week, levels=c(\"Sunday\", \"Monday\",\n","\"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"))\n","```\n","\n","We shall run the average ride time by each day for 'members vs casual users'\n","\n","```{r}\n","aggregate(all_trips_v2$ride_length ~ all_trips_v2$member_casual + all_trips_v2$day_of_week,\n","FUN = mean)\n","```\n","\n"," Next we analyze ridership data by type and weekday\n","\n","```{r}\n","  all_trips_v2 %>%\n","  mutate(weekday = wday(started_at, label = TRUE)) %>%\n","  group_by(member_casual, weekday) %>%\n","  \n","  summarise(number_of_rides = n()\n","            ,average_duration = mean(ride_length)) %>%\n","  arrange(member_casual, weekday) %>%\n","  ggplot(aes(x = weekday, y = number_of_rides, fill = member_casual)) +\n","  geom_col(position = \"dodge\")\n","```\n","\n","```{r}  \n","  all_trips_v2 %>%\n","    mutate(weekday = wday(started_at, label = TRUE)) %>%\n","    group_by(member_casual, weekday) %>%\n","    summarise(number_of_rides = n()\n","              ,average_duration = mean(ride_length)) %>%\n","    arrange(member_casual, weekday) %>%\n","    ggplot(aes(x = weekday, y = average_duration, fill = member_casual)) +\n","    geom_col(position = \"dodge\")\n","  \n","```  \n","------------------------------------------------------------------------------ \n","  \n","# **STEP 5: EXPORT SUMMARY FILE FOR FURTHER ANALYSIS**\n","\n","Beleow is a summary table for further analysis\n","\n","```{r message=FALSE}\n","counts <- aggregate(all_trips_v2$ride_length ~ all_trips_v2$member_casual +\n","                        all_trips_v2$day_of_week, FUN = mean)\n","```\n","\n","\n","# *Key Findings*\n","\n"," - Users with an annual membership complete more rides than casual riders\n","\n"," - Among casual riders, Thursdays, and Fridays,  are the most popular usage days\n","\n"," - Casual riders, on average, spend about 76% more time on their rides than users with an annual membership\n","\n"," - About 67% of total bike rides by casual riders were via electric bikes, compared to about 52% for total bike rides by users with an annual membership\n","\n","\n","\n","\n","# _Recommendations_\n","\n"," 1) Implement a new annual membership tier at a lower price point where a total number of rides are allotted for a given time period (e.g. week, month), versus current annual membership structure (unlimited number of rides, 45-min. limit per ride), and given that on average, casual riders spend more time on their rides than current members, but on average only 1439.3sec.(23.9 min.)\n","\n"," 2) Implement a limited time promotion for annual membership that loosens limits on Friday, Saturday, Sunday rides, given those are the most popular days casual riders use Cyclistic bikes\n","\n"," 3) Add more electric bikes to inventory given casual riders prefer them over classic bikes\n"," \n"," \n","# _Other Considerations for Further Exploration_\n","\n"," * Collect data on available inventory at docking station user is at at point of rental to analyze impact on resulting bike type choice\n","\n"," * Collect data on full route of a bike during rental, not just start and end locations, to analyze if certain areas/geospatial factors constitute certain bike types (e.g. terrain)\n","\n"," * Include data on whether a casual rider uses a single-ride pass or full-day pass, to analyze how pricing may impact usage\n"]}],"metadata":{"kaggle":{"accelerator":"none","dataSources":[],"dockerImageVersionId":30618,"isGpuEnabled":false,"isInternetEnabled":false,"language":"r","sourceType":"notebook"},"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"codemirror_mode":"r","file_extension":".r","mimetype":"text/x-r-source","name":"R","pygments_lexer":"r","version":"4.0.5"},"papermill":{"default_parameters":{},"duration":3.507466,"end_time":"2024-05-15T14:42:35.186675","environment_variables":{},"exception":null,"input_path":"__notebook__.ipynb","output_path":"__notebook__.ipynb","parameters":{},"start_time":"2024-05-15T14:42:31.679209","version":"2.5.0"}},"nbformat":4,"nbformat_minor":5}